# Graphite Apache Virtual Host
#
# Generated by Chef
<% if (node['apache']['listen_ports'] & [ node['graphite']['listen_port'].to_i, node['graphite']['listen_port'].to_s ]).empty? -%>
Listen <%= node['graphite']['listen_port'] %>
<% end -%>
WSGIPythonPath <%= node['graphite']['base_dir'] %>/webapp

# You may need to manually edit this file to fit your needs.
<VirtualHost *:<%= node['graphite']['listen_port']%>>
        ServerName <%= node['graphite']['url'] %>
        ServerAdmin <%= node['graphite']['web']['admin_email'] %>
        DocumentRoot "<%= node['graphite']['doc_root'] %>"
        ErrorLog <%= node['graphite']['storage_dir'] %>/log/webapp/error.log
        CustomLog <%= node['graphite']['storage_dir'] %>/log/webapp/access.log common

        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, OPTIONS"
        Header set Access-Control-Allow-Headers "origin, authorization, accept"

        WSGIScriptAlias / <%= node['graphite']['base_dir'] %>/webapp/graphite/wsgi.py
        <Directory <%= node['graphite']['base_dir'] %>/webapp/graphite>
        <Files wsgi.py>
        Require all granted
        </Files>
        </Directory>

        Alias /static/ <%= node['graphite']['base_dir'] %>/webapp/content/
        <Directory <%= node['graphite']['base_dir'] %>/webapp/content>
        Require all granted
        </Directory>
</VirtualHost>
